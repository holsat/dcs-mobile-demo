# Expo Config Plugins

This directory contains custom Expo config plugins that modify the native iOS and Android projects during prebuild.

## Why Config Plugins?

Expo's `app.json` configuration has limitations. Some native settings can't be configured directly through JSON. Config plugins allow you to programmatically modify native project files during the prebuild process.

---

## `withIOSProductName.js` - iOS Product Name Fix

### The Problem

**Root Cause**: Expo's prebuild sanitizes the app name and removes special characters like `+` when setting the iOS `PRODUCT_NAME` build setting.

**Impact**: 
- `app.json` has `"name": "DCS+"`
- Expo correctly sets `CFBundleDisplayName` to "DCS+" (shown on device)
- But Expo strips the `+` and sets `PRODUCT_NAME` to "DCS"
- App Store rejects submission because an app named "DCS" already exists

### The Solution

This config plugin runs during `expo prebuild` and automatically fixes the `PRODUCT_NAME` in the Xcode project:

```javascript
// Before (generated by Expo):
PRODUCT_NAME = DCS;

// After (fixed by plugin):
PRODUCT_NAME = "DCS+";
```

### How It Works

1. **Registered in app.json**:
   ```json
   {
     "expo": {
       "plugins": [
         "./plugins/withIOSProductName.js"
       ]
     }
   }
   ```

2. **Runs during prebuild**: 
   - User runs: `npx expo prebuild --clean --platform ios`
   - Expo generates the iOS project from app.json
   - Our plugin hooks into the process
   - Plugin modifies the Xcode project.pbxproj file
   - Result: iOS project has correct "DCS+" product name

3. **Automatic and reliable**:
   - No manual editing needed
   - No post-build scripts required
   - Works every time prebuild runs
   - Integrated into Expo's build pipeline

### Usage

Simply run prebuild as normal - the plugin handles everything automatically:

```bash
# Standard prebuild - plugin runs automatically
npm run prebuild:ios

# Or use expo CLI directly
npx expo prebuild --clean --platform ios
```

The plugin will output:
```
âœ… Updated PRODUCT_NAME from DCS to "DCS+"
âœ… Updated PRODUCT_NAME from DCS to "DCS+"
```

### Technical Details

**What it modifies**:
- File: `ios/DCS.xcodeproj/project.pbxproj`
- Section: `pbxXCBuildConfigurationSection()`
- Property: `buildSettings.PRODUCT_NAME`
- Changes: `"DCS"` â†’ `"DCS+"`

**Build configurations affected**:
- Debug configuration
- Release configuration

**Dependencies**:
- `@expo/config-plugins` (part of Expo SDK)
- Uses `withXcodeProject` helper

### Verification

After running prebuild, verify the fix:

```bash
grep "PRODUCT_NAME" ios/DCS.xcodeproj/project.pbxproj
```

Expected output:
```
PRODUCT_NAME = "DCS+";
PRODUCT_NAME = "DCS+";
```

---

## Alternative Solutions Considered

### 1. âŒ Manual Editing
**Problem**: Lost every time prebuild runs

### 2. âŒ Post-Build Script
**Problem**: External to Expo's pipeline, easy to forget

### 3. âœ… Config Plugin (Current Solution)
**Benefits**:
- Integrated into Expo workflow
- Runs automatically during prebuild
- Official Expo pattern
- Version controlled
- No external dependencies

### 4. ðŸ¤” Upstream Fix
**Long-term solution**: Submit PR to Expo to support `+` in product names

---

## Creating New Config Plugins

To create additional config plugins:

1. **Create plugin file** in `plugins/` directory
2. **Export a function** that takes and returns config
3. **Use Expo's helpers**: `withXcodeProject`, `withAndroidManifest`, etc.
4. **Register in app.json** in the `plugins` array

Example structure:
```javascript
const { withXcodeProject } = require('@expo/config-plugins');

const withMyCustomPlugin = (config) => {
  return withXcodeProject(config, (config) => {
    // Modify config.modResults here
    return config;
  });
};

module.exports = withMyCustomPlugin;
```

## Resources

- [Expo Config Plugins Documentation](https://docs.expo.dev/guides/config-plugins/)
- [Creating Custom Config Plugins](https://docs.expo.dev/config-plugins/development-and-debugging/)
- [@expo/config-plugins API Reference](https://github.com/expo/expo/tree/main/packages/@expo/config-plugins)
